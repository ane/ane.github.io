{% assign collection = include.collection %}
{% assign rawcategories = "" %}
{% for post in include.collection %}
{% assign tcategories = post.categories | join:'|' | append:'|' %}
{% assign rawcategories = rawcategories | append:tcategories %}
{% endfor %}
{% assign rawcategories = rawcategories | split:'|' | sort %}

{% assign categories = "" %}
{% for category in rawcategories %}
{% if category != "" %}
{% if categories == "" %}
{% assign categories = category | split:'|' %}
{% endif %}
{% unless categories contains category %}
{% assign categories = categories | join:'|' | append:'|' | append:category | split:'|' %}
{% endunless %}
{% endif %}
{% endfor %}
<ul>
    {% for cat in categories %}
    <li id="{{ cat }}" class="hilink">{{ cat | capitalize }}
        <ul>
        {% for post in collection %}
        {% if post.categories[0] == cat %}
        <li>{{ post.title}} </li>
        {%endif%}
        {%endfor%}
        </ul>
    </li>
    {% endfor %}
</ul>
